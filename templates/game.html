{% extends 'base.html' %}
{% block content %}
<div class="board">
    {% for cat in session['categories'] %}
    <div class="category">
        <div class="category_header">{{cat['title']}}</div>
        {% for clue in cat['clues']%}
        <button class="clue" question="{{clue['question']}}" answer="{{clue['answer']}}" category="{{cat['title']}}">{{clue['value']}}</button>
        {% endfor %}
    </div>
    {%endfor%}
    <div class="game-scores">
        {% for player in session['players'] %}
        <div class="name">{{player['name']}}</div>
        <div class= "score">{{player['score']}}</div>
        {% endfor %}
    </div>
    <div id="question-panel" class="modal fade" role="dialog" data-keyboard="false"> 
        <div class="modal-dialog">  
            <div class = "modal-content">
                <div class="modal-body">  
                    <form id="question-form">
                        <div class="question"></div>
                        <input type="text" class="answer_input" name="answer"/>
                        <!-- <input type="submit" class="submit" value="SUBMIT"/> -->
                        <button>Submit</button>
                    </form>
                </div>
            </div>     
        </div>         
    </div>

    <div id="result-panel" class="modal fade" role="dialog" data-keyboard="false"> 
        <div class="modal-dialog">  
            <div class = "modal-content">
                <div class="modal-body">  
                    <div class='result'></div>

                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Game</button>
                </div>
            </div>     
        </div>         
    </div>

</div>

<script type="text/javascript">
    $(document).ready(function(){
        $('.clue').click(function(e){
            let clue = e.target;
            let question = clue.attributes.question.value;
            let answer = clue.attributes.answer.value;
            let category = clue.attributes.category.value;
            let clueValue = clue.innerText;
            $('#answer').val(answer);
            $(".question").attr("data-clueValue", clueValue);
            $(".question").attr("data-answer", answer);
            $(".question").attr("data-category", category);
            $('.question').append(document.createTextNode(question));
            $('#question-panel').modal({show:true});
        });
        $('#question-panel').on('hidden.bs.modal', function () {
            $('.question').empty();
        });
    });
    $('#question-form').on('submit', function(e){
        let clueValue = $('.question').attr('data-clueValue');
        let clueAnswer = $('.question').attr('data-answer');
        let pAnswer = $('.answer_input').val();
        let category = $('.question').attr('data-category');
        e.preventDefault();
        $.ajax({
            url: "{{url_for('submit_answer')}}",
            data: {'value':clueValue,
                   'clueAnswer':clueAnswer,
                   'pAnswer':pAnswer,
                   'category': category},
            method:'POST',
                success: function(data){
                    if(data['result']==true){
                        var result = 'That\'s Correct! Congratulations';
                    }else{
                        var result = 'Sorry that\'s incorrect!';
                    }
                    $('.result').append(document.createTextNode(result));
                    $('#result-panel').modal('show');
                    //take result data from server
                    //display in modal
                    //update player score - page refresh now?? - 
                    //enable next button - to close modal and move on
                }
            });
        $('#question-panel').modal('hide');
        $('#question-form')[0].reset();
    });
    

    
</script>
{% endblock %}