{% extends 'base.html' %}
{% block content %}
<div class="board">
    {% for cat in session['categories'] %}
    <div class="category">
        <div class="category_header">{{cat['title']}}</div>
        {% for clue in cat['clues']%}
        <button id="{{clue['id']}}" class="clue" question="{{clue['question']}}" answer="{{clue['answer']}}" category="{{cat['title']}}">{{clue['value']}}</button>
        {% endfor %}
    </div>
    {%endfor%}
    <div class="game-scores">
        {% for player in session['players'] %}
        <div class="name">{{player['name']}}</div>
        <div id="number{{player['number']}}" class="score">{{player['score']}}</div>
        {% endfor %}
        {{session['currentPlayer']}}
    </div>

    <div id="question-panel" class="modal fade" role="dialog" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <form id="question-form" action="{{url_for('submit_answer')}}" method="post">
                        <div class="question"></div>
                        <input type="text" class="answer_input" name="pAnswer" />
                        <input type="hidden" id="value" name="value" />
                        <input type="hidden" id="clueId" name="clueId" />
                        <input type="hidden" id="clueAnswer" name="clueAnswer" />
                        <button type="submit">submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="result-panel" class="modal fade" role="dialog" data-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class='result'></div>
                    <button type="button" class="btn btn-secondary continue" data-dismiss="modal">Continue Game</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var disabledClues = "{{session['disabled']}}";
    if (disabledClues[0]) {
        disabledClues = JSON.parse(disabledClues);
        for (let i = 0; i < disabledClues.length; i++) {
            $("#" + disabledClues[i]).attr("disabled", true);
        }
    }
    $(window).on('load',function(){
        var result = "{{result}}";
        var resultText;
        //todo: add player score increase or decrease to result panel
            // will need access to session - player[current player]
        if (result != "") {
            if (result == 'True') {
                resultText = "Congratulations! That\'s correct!";
            } else if (result == 'False') {
                resultText = "Sorry! That was incorrect, better luck next time!";
            }
            $('.result').append(document.createTextNode(resultText));
            $('#result-panel').modal('show');
        }
    });

    $(document).ready(function () {
        $('.clue').click(function (e) {
            let clue = e.target;
            let id = clue.attributes.id.value;
            let question = clue.attributes.question.value;
            let answer = clue.attributes.answer.value;
            let clueValue = clue.innerText;
            $('#clueAnswer').val(answer);
            $('#clueId').val(id);
            $('#value').val(clueValue);
            $('.question').append(document.createTextNode(question));
            $('#question-panel').modal('show');
            $('#' + id).prop('disabled', true);
        });
        $('.continue').click(function(e){
            // todo: if disabled = 30 load round sumary page
        });
        $('#question-form').on('submit', function () {
            $('#question-panel').modal('hide');
        });

        $('#question-panel').on('hidden.bs.modal', function () {
            $('.question').empty();
        });
       
        $('#result-panel').on('hidden.bs.modal', function () {
            $('.result').empty();

        });
     
    });

</script>
{% endblock %}